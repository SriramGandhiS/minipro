<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Smart Attendance | Take Attendance</title>
    <link rel="stylesheet" href="app.css">
</head>

<body data-page="attendance">

    <!-- SIDEBAR -->
    <aside class="app-sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon">SA</div>
            <div>
                <div class="brand-name">SmartAttendance</div>
                <div class="brand-sub">PSNACET ¬∑ Admin</div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section-label">Main</div>
            <a href="dashboard.html" class="nav-link"><span class="nav-icon">üìä</span>Dashboard</a>
            <a href="attendance.html" class="nav-link active"><span class="nav-icon">üì∑</span>Take Attendance</a>
            <a href="register.html" class="nav-link"><span class="nav-icon">‚ûï</span>Register Student</a>
            <a href="profile.html" class="nav-link"><span class="nav-icon">üë§</span>Student Profile</a>
            <div class="nav-section-label">More</div>
            <a href="index.html" class="nav-link"><span class="nav-icon">üè†</span>Home</a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-row">
                <div class="user-avatar" id="user-av">A</div>
                <div>
                    <div class="user-info-name" id="user-nm">Admin</div>
                    <div class="user-info-role">Administrator</div>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Sign Out</button>
        </div>
    </aside>

    <!-- TOP BAR -->
    <header class="app-topbar">
        <div class="topbar-left">
            <span class="topbar-title">Take Attendance</span>
        </div>
        <div class="topbar-right">
            <div class="topbar-date" id="topbar-date"></div>
            <span id="scan-state">Stopped</span>
            <a href="dashboard.html" class="topbar-cta">üìä View Dashboard</a>
        </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
        <div class="page-body">

            <div class="section-hdr">
                <div>
                    <h2>AI Face Recognition</h2>
                    <p>Point the camera at the class ‚Äî students are marked automatically every 3 seconds</p>
                </div>
            </div>

            <div style="display:grid;grid-template-columns:1.1fr 0.9fr;gap:20px;align-items:start;">

                <!-- Camera -->
                <div>
                    <div class="camera-wrap" style="margin-bottom:14px;">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="canvas" style="display:none;"></canvas>
                    </div>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <button class="btn-accent" onclick="startAttendance()" style="flex:1;">‚ñ∂ Start Scanning</button>
                        <button class="btn-outline" onclick="stopAttendance()" style="flex:1;">‚ñ† Stop</button>
                    </div>
                </div>

                <!-- Info + Log -->
                <div style="display:flex;flex-direction:column;gap:14px;">
                    <div class="card">
                        <div class="card-title">How It Works</div>
                        <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px;">
                            <div class="info-row"><span
                                    style="background:rgba(203,255,77,0.1);color:var(--accent);width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">1</span><span
                                    style="color:var(--text-dim);font-size:0.82rem;">Click <strong
                                        style="color:var(--accent);">Start Scanning</strong> to begin</span></div>
                            <div class="info-row"><span
                                    style="background:rgba(203,255,77,0.1);color:var(--accent);width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">2</span><span
                                    style="color:var(--text-dim);font-size:0.82rem;">Faces are recognized every <strong
                                        style="color:var(--text);">3 seconds</strong></span></div>
                            <div class="info-row"><span
                                    style="background:rgba(203,255,77,0.1);color:var(--accent);width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">3</span><span
                                    style="color:var(--text-dim);font-size:0.82rem;">Attendance saved to database
                                    automatically</span></div>
                            <div class="info-row"><span
                                    style="background:rgba(203,255,77,0.1);color:var(--accent);width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;flex-shrink:0;">4</span><span
                                    style="color:var(--text-dim);font-size:0.82rem;">Click <strong
                                        style="color:var(--text);">Stop</strong> at end of class</span></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">Recognition Log</div>
                        <div style="margin-top:10px;">
                            <pre id="output">Ready. Press Start Scanning to begin.</pre>
                        </div>
                    </div>

                    <div style="display:flex;gap:10px;">
                        <a href="register.html" class="btn-outline" style="flex:1;text-align:center;">‚ûï Register New
                            Student</a>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- CHAT -->
    <button id="chat-toggle-btn" onclick="toggleChat()">üí¨</button>
    <div id="admin-chat-widget">
        <div class="chat-header" onclick="toggleChat()">ü§ñ AI Assistant <span>‚ñº</span></div>
        <div class="chat-body">
            <div class="chat-messages" id="chat-messages">
                <div class="msg ai">Ask me about attendance data.</div>
            </div>
            <div class="chat-input-area">
                <input id="chat-input" placeholder="Ask‚Ä¶" onkeypress="if(event.key==='Enter')sendAdminChat()">
                <button onclick="sendAdminChat()">‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('topbar-date').textContent = new Date().toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short' });
        document.addEventListener('DOMContentLoaded', () => {
            const info = sessionStorage.getItem('userInfo');
            if (info) { try { const u = JSON.parse(info); const n = u.name || 'Admin'; document.getElementById('user-nm').textContent = n.split(' ')[0]; document.getElementById('user-av').textContent = n[0].toUpperCase(); } catch (_) { } }
        });
        function toggleChat() { document.getElementById('admin-chat-widget').classList.toggle('open'); }
    </script>
    <script src="script.js" defer></script>
</body>

</html>