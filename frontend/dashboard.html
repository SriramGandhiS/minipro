<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Smart Attendance | Dashboard</title>
  <link rel="stylesheet" href="app.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>

<body data-page="dashboard">

  <!-- SIDEBAR -->
  <aside class="app-sidebar">
    <div class="sidebar-brand">
      <div class="brand-icon">SA</div>
      <div>
        <div class="brand-name">SmartAttendance</div>
        <div class="brand-sub">PSNACET Â· Admin</div>
      </div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Main</div>
      <a href="dashboard.html" class="nav-link active"><span class="nav-icon">ğŸ“Š</span>Dashboard</a>
      <a href="attendance.html" class="nav-link"><span class="nav-icon">ğŸ“·</span>Take Attendance</a>
      <a href="register.html" class="nav-link"><span class="nav-icon">â•</span>Register Student</a>
      <a href="profile.html" class="nav-link"><span class="nav-icon">ğŸ‘¤</span>Student Profile</a>
      <div class="nav-section-label">Reports</div>
      <a href="dashboard.html" class="nav-link"><span class="nav-icon">ğŸ“…</span>Monthly Report</a>
      <a href="dashboard.html" class="nav-link"><span class="nav-icon">ğŸ“ˆ</span>Analytics</a>
      <div class="nav-section-label">More</div>
      <a href="index.html" class="nav-link"><span class="nav-icon">ğŸ </span>Home</a>
    </nav>
    <div class="sidebar-footer">
      <div class="user-row">
        <div class="user-avatar" id="user-av">A</div>
        <div>
          <div class="user-info-name" id="user-nm">Admin</div>
          <div class="user-info-role">Administrator</div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">Sign Out</button>
    </div>
  </aside>

  <!-- TOP BAR -->
  <header class="app-topbar">
    <div class="topbar-left">
      <span class="topbar-title">Dashboard</span>
      <div class="topbar-search">
        <span>ğŸ”</span>
        <input id="search-name" placeholder="Search studentâ€¦" onkeypress="if(event.key==='Enter')searchFromDashboard()">
      </div>
    </div>
    <div class="topbar-right">
      <div class="topbar-date" id="topbar-date"></div>
      <div class="topbar-icon-btn" title="Notifications">ğŸ””<span class="notif-dot"></span></div>
      <div class="topbar-icon-btn" onclick="loadReport()" title="Refresh">â†»</div>
      <a href="attendance.html" class="topbar-cta">ğŸ“· Take Attendance</a>
    </div>
  </header>

  <!-- MAIN -->
  <main class="app-main">
    <div class="page-body">

      <div class="section-hdr">
        <div>
          <h2>Attendance Overview</h2>
          <p>Real-time classroom intelligence â€” auto-refreshes every 10s</p>
        </div>
        <div style="display:flex;gap:8px;">
          <span class="chip chip-green">â— Safe &gt;85%</span>
          <span class="chip chip-yellow">â— Risk &lt;75%</span>
          <span class="chip chip-red">â— Critical &lt;60%</span>
        </div>
      </div>

      <!-- STAT CARDS -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-meta">
            <div class="stat-lbl">Live Occupancy</div>
            <div class="stat-val" id="stat-occupancy">--</div>
            <div class="stat-note">Students present now</div>
          </div>
          <div class="stat-badge" style="background:rgba(203,255,77,0.1);">ğŸ§‘â€ğŸ«</div>
        </div>
        <div class="stat-card">
          <div class="stat-meta">
            <div class="stat-lbl">Most Skipped</div>
            <div class="stat-val" id="stat-skipped" style="font-size:1.3rem;">--</div>
            <div class="stat-note">Period with most absences</div>
          </div>
          <div class="stat-badge" style="background:rgba(251,146,60,0.1);">âš ï¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-meta">
            <div class="stat-lbl">Total Students</div>
            <div class="stat-val">62</div>
            <div class="stat-note">Enrolled in system</div>
          </div>
          <div class="stat-badge" style="background:rgba(74,222,128,0.1);">ğŸ‘¥</div>
        </div>
        <div class="stat-card">
          <div class="stat-meta">
            <div class="stat-lbl">Periods / Day</div>
            <div class="stat-val">8</div>
            <div class="stat-note">8am â€“ 4pm schedule</div>
          </div>
          <div class="stat-badge" style="background:rgba(79,142,255,0.1);">ğŸ•</div>
        </div>
      </div>

      <!-- CHARTS ROW -->
      <div class="panels-row" id="analytics-panel">
        <div class="panel-card">
          <div class="panel-head">
            <h4>Weekly Attendance Trend</h4>
            <span class="panel-tag">This Week</span>
          </div>
          <canvas id="trendChart" style="max-height:170px;"></canvas>
        </div>
        <div class="panel-card">
          <div class="panel-head">
            <h4>Period Ã— Day Heatmap</h4>
            <span class="panel-tag">P1â€“P8 / Monâ€“Fri</span>
          </div>
          <div style="font-size:0.68rem;color:var(--text-muted);margin-bottom:10px;">Darker = more absences</div>
          <div id="heatmap-grid" class="heatmap-grid"></div>
        </div>
      </div>

      <!-- CONTROLS -->
      <div class="controls-bar">
        <span style="font-size:0.75rem;color:var(--text-muted);font-weight:600;">Filter:</span>
        <select id="month-select" class="ctrl-select"></select>
        <button class="btn-outline" onclick="loadSelectedMonth()">View Month</button>
        <button class="btn-accent" onclick="searchFromDashboard()">Search</button>
      </div>

      <!-- TABLE -->
      <div class="data-table-wrap">
        <div class="data-table-head">
          <h3>Attendance Records</h3>
          <span style="font-size:0.7rem;color:var(--text-muted);">Click column header to sort</span>
        </div>
        <div style="overflow-x:auto;">
          <table id="table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>Date</th>
                <th>P1 8am</th>
                <th>P2 9am</th>
                <th>P3 10am</th>
                <th>P4 11am</th>
                <th>P5 12pm</th>
                <th>P6 1pm</th>
                <th>P7 2pm</th>
                <th>P8 3pm</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <section id="student-profile" class="card hidden" style="margin-top:16px;"></section>
    </div>
  </main>

  <!-- CHAT -->
  <button id="chat-toggle-btn" onclick="toggleChat()">ğŸ’¬</button>
  <div id="admin-chat-widget">
    <div class="chat-header" onclick="toggleChat()">ğŸ¤– AI Admin Assistant <span>â–¼</span></div>
    <div class="chat-body">
      <div class="chat-messages" id="chat-messages">
        <div class="msg ai">Hello Admin! Ask me anything.<br><em style="opacity:0.6">e.g. "Who missed Period 3
            today?"</em></div>
      </div>
      <div class="chat-input-area">
        <input id="chat-input" placeholder="Ask about attendanceâ€¦" onkeypress="if(event.key==='Enter')sendAdminChat()">
        <button onclick="sendAdminChat()">â†’</button>
      </div>
    </div>
  </div>

  <script>
    // Date in topbar
    const d = new Date();
    document.getElementById('topbar-date').textContent = d.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short' });

    // User info from session
    document.addEventListener('DOMContentLoaded', () => {
      const info = sessionStorage.getItem('userInfo');
      if (info) { try { const u = JSON.parse(info); const n = u.name || u.email || 'Admin'; document.getElementById('user-nm').textContent = n.split(' ')[0]; document.getElementById('user-av').textContent = n[0].toUpperCase(); } catch (_) { } }
    });

    function toggleChat() {
      document.getElementById('admin-chat-widget').classList.toggle('open');
    }
  </script>
  <script src="script.js" defer></script>
</body>

</html>